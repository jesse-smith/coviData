shape = weibull_est$estimate[[1]],
scale = weibull_est$estimate[[2]]
)
gamma_sample <- rgamma(
10000,
shape = gamma_est$estimate[[1]],
rate = gamma_est$estimate[[2]]
)
weibull_est <- fitdistrplus::fitdist(x, dist = "weibull")
x <- sample(k_data$q, size = 10000, prob = k_data$d, replace = TRUE)
weibull_est <- fitdistrplus::fitdist(x, dist = "weibull")
gamma_est <- fitdistrplus::fitdist(x, dist = "gamma")
gengamma_est <- fitdistrplus::fitdist(
x ,
dist = "gengamma",
start = list(mu = 1, sigma = 1, Q = 1)
)
weibull_sample <- rweibull(
10000,
shape = weibull_est$estimate[[1]],
scale = weibull_est$estimate[[2]]
)
gamma_sample <- rgamma(
10000,
shape = gamma_est$estimate[[1]],
rate = gamma_est$estimate[[2]]
)
gengamma_sample <- rgengamma(
10000,
mu = gengamma_est$estimate[[1]],
sigma = gengamma_est$estimate[[2]],
Q = gengamma_est$estimate[[3]]
)
tibble(
k_density = x,
gamma = gamma_sample,
weibull = weibull_sample,
gengamma = gengamma_sample
) %>%
pivot_longer(everything()) %>%
ggplot(aes(x = value)) +
geom_density(aes(color = name))
gengamma_est
write_rds(k_data, file = "k_density_duration.rds")
write_rds(k_data, path = "k_density_duration.rds")
k_data <- read_rds("k_density_duration.rds")
# Plot results
tibble(
k_density = x,
gamma = gamma_sample,
weibull = weibull_sample,
gengamma = gengamma_sample
) %>%
pivot_longer(everything()) %>%
ggplot(aes(x = value)) +
geom_density(aes(color = name)) +
ggtitle("Parametric fits to kernel density")
# Plot results
fig <- tibble(
k_density = x,
gamma = gamma_sample,
weibull = weibull_sample,
gengamma = gengamma_sample
) %>%
pivot_longer(everything()) %>%
ggplot(aes(x = value)) +
geom_density(aes(color = name)) +
ggtitle("Parametric fits to kernel density")
ggsave("fig1.png")
weibull_est$estimate
gamma_est$estimate
gengamma_est$estimate
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(binwidth = 1)
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_col(binwidth = 1)
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(binwidth = 1)
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(binwidth = 1) + geom_density()
?geom_histogram
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(binwidth = 1) + geom_density(aes(after_stat(density)))
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(aes(x = after_stat(density)), binwidth = 1) + geom_density(aes(x = after_stat(density)))
ggplot(nbs_data, aes(x = hsptl_duration_days)) + geom_histogram(aes((after_stat(density)), binwidth = 1) + geom_density()
ggplot(nbs_data, aes(x = hsptl_duration_days)) +
geom_histogram(aes(after_stat(density)))
ggplot(nbs_data, aes(x = hsptl_duration_days)) +
geom_histogram(aes(after_stat(x = density)))
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)))
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density))) +
geom_density(aes(x = hsptl_duration_days))
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density))) +
geom_density(aes(x = hsptl_duration_days)) +
geom_density(aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE)))
ggplot(nbs_data, aes()) +
stat_Coun't(aes(hsptl_duration_days, after_stat(density))) +
geom_density(aes(x = hsptl_duration_days)) +
geom_density(aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE)))
ggplot(nbs_data, aes()) +
stat_count(aes(hsptl_duration_days, after_stat(density))) +
geom_density(aes(x = hsptl_duration_days)) +
geom_density(aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE)))
ggplot(nbs_data, aes()) +
stat_count(aes(hsptl_duration_days, after_stat(density))) +
geom_density(aes(x = hsptl_duration_days)) +
geom_density(
aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE))
)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(aes(x = hsptl_duration_days)) +
geom_density(
aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE))
)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(x = sample(x, size = NROW(nbs_data), replace = TRUE))
)
geom_density(
aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE))
)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(x = sample(x, size = NROW(nbs_data), replace = TRUE))
) +
geom_density(
aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE))
)
# Fit gamma, weibull, and generalized gamma
k_sample <- sample(k_data$q, size = 10000, prob = k_data$d, replace = TRUE)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(x = sample(k_sample, size = NROW(nbs_data), replace = TRUE))
) +
geom_density(
aes(x = sample(gengamma_sample, size = NROW(nbs_data), replace = TRUE))
)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(
x = sample(k_sample, size = NROW(nbs_data), replace = TRUE),
color = "KDE"
)
)
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(
x = sample(k_sample, size = NROW(nbs_data), replace = TRUE),
color = "KDE"
)
) +
ggtitle("KDE vs Raw Data Histogram (binwidth = 1)")
ggsave("dist_compare.png")
write_csv(k_data, path = "k_density_duration.csv")
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(
x = sample(k_sample, size = NROW(nbs_data), replace = TRUE),
color = "KDE"
)
) +
geom_density(
aes(
x = sample(gamma_sample, size = NROW(nbs_data), replace = TRUE),
color = "Gamma"
)
) +
ggtitle("KDE vs Raw Data Histogram (binwidth = 1)")
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(
x = sample(k_sample, size = NROW(nbs_data), replace = TRUE),
color = "KDE"
)
) +
geom_density(
aes(
x = sample(weibull_sample, size = NROW(nbs_data), replace = TRUE),
color = "Gamma"
)
) +
ggtitle("KDE vs Raw Data Histogram (binwidth = 1)")
ggplot(nbs_data, aes()) +
geom_histogram(aes(hsptl_duration_days, after_stat(density)), binwidth = 1) +
geom_density(
aes(
x = sample(k_sample, size = NROW(nbs_data), replace = TRUE),
color = "KDE"
)
) +
geom_density(
aes(
x = sample(gamma_sample, size = NROW(nbs_data), replace = TRUE),
color = "Gamma"
)
) +
ggtitle("KDE vs Raw Data Histogram (binwidth = 1)")
ggsave("dist_compare.png")
nbs_data$positive_pcr
nbs_data %>%
distinct(patient_local_id)
distinct(first_name)
nbs_data %>%
distinct(patient_first_name, patient_last_name, patient_dob)
distinct(patient_first_name, patient_last_name, patient_dob, patient_state)
nbs_data %>%
distinct(patient_first_name, patient_last_name, patient_dob, patient_state)
nbs_data %>%
distinct(patient_first_name, patient_last_name, patient_dob, patient_zip)
# Creating shareable data for Tomi et al
# library(kdensity)
devtools::load_all()
library(fitdistrplus)
library(tidyverse)
library(flexsurv)
# Omit max observation (76 days) as outlier - problematic for kde and fitting
nbs_data %>%
transmute(duration = hsptl_duration_days) %>%
filter(!is.na(duration) & duration < 76) %>%
.[[1]] ->
duration
# Omit max observation (76 days) as outlier - problematic for kde and fitting
get_nbs(Sys.Date()-1) %>%
transmute(duration = hsptl_duration_days) %>%
filter(!is.na(duration) & duration < 76) %>%
.[[1]] ->
duration
# Omit max observation (76 days) as outlier - problematic for kde and fitting
get_nbs(Sys.Date() - 1) %>%
rename(duration = hsptl_duration_days) %>%
filter(!is.na(duration) & duration < 76) ->
nbs_data
# Histogram
ggplot(nbs_data, aes(x = duration)) + geom_hist(aes(after_stat(density)))
# Histogram
ggplot(nbs_data, aes(x = duration)) + geom_histogram(aes(after_stat(density)))
# Histogram
ggplot(nbs_data, aes(x = duration)) + geom_histogram(x = duration , aes(after_stat(density)))
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, after_stat(density)))
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, after_stat(density)), binwidth = 1)
# Histogram
ggplot(nbs_data) +
facet_wrap(vars(died_from_illness_ind))
# Histogram
ggplot(nbs_data) +
facet_wrap(vars(die_from_illness_ind))
# Histogram
ggplot(nbs_data) +
facet_wrap(vars(die_from_illness_ind)) %>%
geom_histogram(aes(x = duration, after_stat(density)), binwidth = 1)
# Histogram
ggplot(nbs_data) +
facet_wrap(vars(die_from_illness_ind)) +
geom_histogram(aes(x = duration, after_stat(density)), binwidth = 1)
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, after_stat(density), color = die_from_illness_ind), binwidth = 1)
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, after_stat(density), fill = die_from_illness_ind), binwidth = 1)
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, fill = die_from_illness_ind), binwidth = 1)
# Histogram
ggplot(nbs_data) +
geom_histogram(aes(x = duration, after_stat(density), fill = die_from_illness_ind), binwidth = 1)
?geom_histogram
# Histogram
ggplot(nbs_data) +
geom_density(aes(x = duration, fill = die_from_illness_ind))
# Histogram
ggplot(nbs_data) +
geom_density(aes(x = duration, fill = die_from_illness_ind), linetype = "blank", alpha = 1/3)
# Histogram
ggplot(nbs_data) +
geom_density(aes(x = duration, fill = die_from_illness_ind), alpha = 1/3)
# Histogram
ggplot(nbs_data) +
facet_grid(vars(die_from_illness_ind)) +
geom_density(aes(x = duration, fill = die_from_illness_ind), alpha = 1/3)
# Histogram
nbs_data %>%
rename(Died = die_from_illness_ind) %>%
ggplot(nbs_data) +
facet_grid(vars(die_from_illness_ind)) +
geom_density(aes(x = duration, fill = die_from_illness_ind), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(Died = die_from_illness_ind) %>%
ggplot(nbs_data) +
facet_grid(vars(Died)) +
geom_density(aes(x = duration, fill = Died), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(Died = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(Died)) +
geom_density(aes(x = duration, fill = Died), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(Died)) +
geom_density(aes(x = duration, fill = Died), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(`Died from COVID-19`)) +
geom_density(aes(x = duration, fill = `Died from COVID-19`), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(`Died from COVID-19`), scales = "free_y") +
geom_density(aes(x = duration, fill = `Died from COVID-19`), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(`Died from COVID-19`)) +
geom_density(aes(x = duration, fill = `Died from COVID-19`), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
# facet_grid(vars(`Died from COVID-19`)) +
geom_density(aes(x = duration), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
ggplot() +
facet_grid(vars(`Died from COVID-19`)) +
geom_density(aes(x = duration, fill = `Died from COVID-19`), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
ggsave("duration_death.png")
nbs_data %>%
group_by(die_from_illness_ind, icu_admit_ind) %>%
summarize(n()/NROW(nbs_data))
nbs_data %>%
group_by(die_from_illness_ind, icu_admit_ind) %>%
summarize(n())
table(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind)
table(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind)
table(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind) %>%
marginSums()
table(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind) %>%
margin.table()
table(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind)
?janitor::tabyl(nbs_data)
?janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind)
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind)
?janitor::adorn_totals()
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind) %>% janitor::adorn_percentages(denominator = c("row", "col"))
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind) %>% janitor::adorn_percentages(denominator = c("all"))
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind) %>% janitor::adorn_total(where = c("row", "col"))
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind) %>% janitor::adorn_totals(where = c("row", "col"))
janitor::tabyl(nbs_data, die_from_illness_ind, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt()
?gt::cols_label
?gt::tab_spanner
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU")
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind)
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = icu_admit_ind)
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(icu_admit_ind))
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(No, Yes))
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU")
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = everything())
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(NO, UNKNOWN, YES, NA_))
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(NO, UNKNOWN, YES, NA_)) %>%
gt::tab_header("Deaths by ICU Admission")
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(NO, UNKNOWN, YES, NA_)) %>%
gt::tab_header("Deaths by ICU Admission") %>%
gt::gtsave("icu_deaths.png")
install.packages("webshot")
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(NO, UNKNOWN, YES, NA_)) %>%
gt::tab_header("Deaths by ICU Admission") %>%
gt::gtsave("icu_deaths.png")
webshot::install_phantomjs()
nbs_data %>%
rename(`Died from COVID-19` = die_from_illness_ind) %>%
janitor::tabyl(`Died from COVID-19`, icu_admit_ind) %>%
janitor::adorn_totals(where = c("row", "col")) %>%
gt::gt() %>%
gt::tab_spanner(label = "Admitted to ICU", columns = vars(NO, UNKNOWN, YES, NA_)) %>%
gt::tab_header("Deaths by ICU Admission") %>%
gt::gtsave("icu_deaths.png")
# Histogram
nbs_data %>%
rename(`Admitted to ICU` = icu_admit_ind) %>%
ggplot() +
facet_grid(vars(`Admitted to ICU`)) +
geom_density(aes(x = duration, fill = `Admitted to ICU`), alpha = 1/3) +
labs(title = "Length of Stay by Death Classification") +
xlab("Length of Stay (days)") +
ylab("Density")
# Histogram
nbs_data %>%
rename(`Admitted to ICU` = icu_admit_ind) %>%
ggplot() +
facet_grid(vars(`Admitted to ICU`)) +
geom_density(aes(x = duration, fill = `Admitted to ICU`), alpha = 1/3) +
labs(title = "Length of Stay by ICU Admission") +
xlab("Length of Stay (days)") +
ylab("Density")
ggsave("duration_icu.png")
chisq.test(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind)
?chisq.test(nbs_data$die_from_illness_ind, nbs_data$icu_admit_ind)
install.packages("assocstats")
devtools::load_all(".")
replace_ael()
library(tidyverse)
replace_ael()
devtools::load_all(".")
replace_ael()
check_ael()
devtools::load_all(".")
check_ael()
devtools::load_all(".")
check_ael()
?janitor::tabyl
devtools::load_all(".")
check_ael()
